{"version":3,"sources":["../../../app/js/index.js"],"names":["window","addEventListener","user","id","email","changeFormatDate","date","moment","format","commentsMessage","urlComment","commentMethod","getComment","counts","console","log","$","ajax","url","type","data","count","offset","success","commentList","renderComment","setComment","message","parentName","dateType","content","parent","length","editComment","messageId","_method","deleteComment","commentId","loadComment","addEventFormReplyCancel","find","click","remove","addEventFormSend","actionName","e","target","siblings","value","addActionsTemplate","commentClass","edit","del","reply","eq","after","htmlTemplates","actions","renderCommentReply","comment","i","children","forEach","el","created_at","append","author","name","getItemObjectWhichClick","htmlBlockComment","closest","attr","actionCommentEdit","hasClass","formAddReply","actionCommentDelete","actionCommentReply","addEventComment","each","comments","empty","addComment","document","getElementById"],"mappings":"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","file":"index.js","sourcesContent":["// import { htmlTemplates } from './html__templates.js';\nwindow.addEventListener('load', () => {\n  const user = {\n    id: 1,\n    email: '19successful91@gmail.com',\n  };\n  function changeFormatDate(date) {\n    return moment(date).format('YYYY-MM-DD a hh:mm');\n  }\n  let commentsMessage;\n  const urlComment = `http://frontend-test.pingbull.com/pages/${user.email}/comments/`;\n  const commentMethod = {\n    getComment: (counts = 2) => {\n      console.log(urlComment);\n      $.ajax({\n        url: urlComment,\n        type: 'GET',\n        data: {\n          count: counts,\n          offset: 0,\n        },\n        success: (commentList) => {\n          commentsMessage = commentList;\n          renderComment(commentList);\n        },\n      });\n    },\n\n    setComment: (message, parentName = null) => {\n      $.ajax({\n        url: urlComment,\n        type: 'POST',\n        dateType: 'json',\n        data: {\n          content: message,\n          parent: parentName,\n        },\n        success: () => {\n          commentMethod.getComment(commentsMessage.length);\n        },\n      });\n    },\n\n    editComment: (message, messageId) => {\n      $.ajax({\n        url: urlComment + messageId,\n        dateType: 'json',\n        type: 'PUT',\n        data: {\n          content: message,\n          _method: 'PUT',\n        },\n        success: () => {\n          commentMethod.getComment(commentsMessage.length);\n        },\n      });\n    },\n\n    deleteComment: (commentId) => {\n      $.ajax({\n        url: urlComment + commentId,\n        type: 'POST',\n        data: {\n          _method: 'DELETE',\n        },\n        success: () => {\n          commentMethod.getComment(commentsMessage.length);\n        },\n      });\n    },\n\n    loadComment: () => {\n      $.ajax({\n        url: urlComment,\n        type: 'GET',\n        data: {\n          count: commentsMessage.length + 5,\n          offset: 0,\n        },\n        success: (commentList) => {\n          commentsMessage = commentList;\n          renderComment(commentsMessage);\n        },\n      });\n    },\n  };\n  function addEventFormReplyCancel() {\n    $('#comment__add__reply')\n      .find('.comment__add__reply__header__cancel')\n      .click(() => {\n        $('#comment__add__reply').remove();\n      });\n  }\n\n  function addEventFormSend(actionName, parentName) {\n    $('#comment__add__reply')\n      .find('.comment__button')\n      .click((e) => {\n        if ($(e.target).siblings('textarea')[0].value) {\n          actionName($(e.target).siblings('textarea')[0].value, parentName);\n        }\n\n        $('#comment__add__reply').remove();\n      });\n  }\n\n  function addActionsTemplate(commentClass, edit, del, reply) {\n    $('#comments__all')\n      .find(`.${commentClass}`)\n      .eq(-1)\n      .find('.comment__text')\n      .after(htmlTemplates.actions(edit, del, reply));\n  }\n\n  function renderCommentReply(comment, i) {\n    comment.children.forEach((el) => {\n      const reply = el;\n      reply.created_at = changeFormatDate(reply.created_at); // edit format date\n      $('#comments__all')\n        .find('.reply')\n        .eq(i)\n        .append(htmlTemplates.reply(comment.author.name, reply));\n\n      if (reply.author.id === user.id) {\n        addActionsTemplate('comment__reply', true, true, false);\n      }\n    });\n  }\n\n  function getItemObjectWhichClick(e) {\n    let comment;\n    const htmlBlockComment = e.closest('li');\n    commentsMessage.forEach((el) => {\n      if (+el.id === +htmlBlockComment.attr('data-commentId')) {\n        comment = el;\n      } else {\n        el.children.forEach((reply) => {\n          if (+reply.id === +htmlBlockComment.attr('data-commentId')) comment = reply;\n        });\n      }\n    });\n    return comment;\n  }\n\n  function actionCommentEdit(e) {\n    const comment = getItemObjectWhichClick(e);\n    console.log(comment);\n    const htmlBlockComment = e.closest('li');\n    $('#comment__add__reply').remove();\n    if (htmlBlockComment.hasClass('comments')) {\n      htmlBlockComment\n        .find('.comment')\n        .after(\n          htmlTemplates.formAddReply(comment.author.name, true, comment.content),\n        );\n    } else if (htmlBlockComment.hasClass('comment__reply')) {\n      htmlBlockComment\n        .after(\n          htmlTemplates.formAddReply(comment.author.name, true, comment.content),\n        );\n    }\n\n    addEventFormReplyCancel();\n    addEventFormSend(commentMethod.editComment, comment.id);\n  }\n\n  function actionCommentDelete(e) {\n    commentMethod.deleteComment(e.closest('li').attr('data-commentId'));\n  }\n\n  function actionCommentReply(e) {\n    const comment = getItemObjectWhichClick(e);\n    const htmlBlockComment = e.closest('li');\n    $('#comment__add__reply').remove();\n\n    htmlBlockComment\n      .find('.comment')\n      .after(htmlTemplates.formAddReply(comment.author.name)); // added the answer form to html\n\n    addEventFormReplyCancel();\n    addEventFormSend(commentMethod.setComment, comment.id);\n  }\n  function addEventComment() {\n    // hangs the event handler on the button wrapper, which checks the pressed element and\n    // calls the desired function so as not to generate a bunch of event handlers.\n    $('.comments').find('.actions').each((i, comment) => {\n      $(comment).click((e) => {\n        if ($(e.target).hasClass('actions__edit')) {\n          console.log($(e.target));\n          actionCommentEdit($(e.target));\n        } else if ($(e.target).hasClass('actions__delete')) {\n          actionCommentDelete($(e.target));\n        } else if ($(e.target).hasClass('actions__reply')) {\n          actionCommentReply($(e.target));\n        }\n      });\n    });\n  }\n\n  function renderComment(comments) {\n    // clear the block with comments and pars all the\n    // comments again that we received\n    $('#comments__all').empty();\n\n    $.each(comments, (i, el) => {\n      const comment = el;\n      comment.created_at = changeFormatDate(comment.created_at); // edit format date\n      $('#comments__all').append(htmlTemplates.message(comment));\n\n      if (comment.author.id === user.id) {\n        addActionsTemplate('comment', true, true, true);\n      } else {\n        addActionsTemplate('comment', false, false, true);\n      }\n\n      if (comment.children.length > 0) {\n        renderCommentReply(comment, i);\n      }\n    });\n    addEventComment();\n  }\n\n  function addComment() {\n    const message = $('#comment__add__textarea')[0].value;\n    commentMethod.setComment(message);\n  }\n\n  commentMethod.getComment();\n  document.getElementById('comment__add__input').addEventListener('click', addComment);\n  document.getElementById('comments__load').addEventListener('click', commentMethod.loadComment);\n});\n"]}